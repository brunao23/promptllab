exports.id=301,exports.ids=[301],exports.modules={4999:(a,b,c)=>{Promise.resolve().then(c.bind(c,8525))},8525:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>o});var d=c(21124),e=c(38301),f=c(42378),g=c(10643),h=c(36369),i=c(84680),j=c(65812);let k=()=>{let[a,b]=(0,e.useState)(null),[c,f]=(0,e.useState)(null),[g,h]=(0,e.useState)(null),[i,k]=(0,e.useState)(!0);if((0,e.useEffect)(()=>{(async()=>{try{let[a,c,d]=await Promise.all([(0,j.Ty)(),(0,j.zN)(),(0,j.vQ)()]);b(a),f(c),h(d),a||(console.warn("‚ö†Ô∏è [SubscriptionInfo] Nenhuma informa\xe7\xe3o de plano encontrada. Usando valores padr\xe3o do trial."),console.warn("\uD83D\uDCA1 [SubscriptionInfo] Execute o script CORRIGIR_SAAS_COMPLETO.sql no Supabase SQL Editor."))}catch(a){console.error("‚ùå [SubscriptionInfo] Erro ao carregar informa\xe7\xf5es da assinatura:",a),console.error("‚ùå [SubscriptionInfo] Erro detalhado:",a.message,a.stack),k(!1)}finally{k(!1)}})()},[]),i)return(0,d.jsx)("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-4 border border-white/10",children:(0,d.jsxs)("div",{className:"animate-pulse",children:[(0,d.jsx)("div",{className:"h-4 bg-white/10 rounded w-1/3 mb-2"}),(0,d.jsx)("div",{className:"h-4 bg-white/10 rounded w-1/2"})]})});if(!a||!c||!g)return(0,d.jsxs)("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-5 border border-white/10 shadow-xl",children:[(0,d.jsx)("div",{className:"flex items-center justify-between mb-4 pb-4 border-b border-white/10",children:(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,d.jsx)("h3",{className:"text-white font-bold text-base",children:"Trial Gr\xe1tis"}),(0,d.jsx)("span",{className:"px-2 py-0.5 bg-emerald-500/20 border border-emerald-500/50 rounded text-emerald-400 text-xs font-bold",children:"TRIAL"})]}),(0,d.jsx)("p",{className:"text-emerald-400 text-sm font-medium mt-1",children:"‚è∞ 7 dias restantes"})]})}),(0,d.jsxs)("div",{className:"mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,d.jsx)("span",{className:"text-white/60 text-xs",children:"Tokens do M\xeas"}),(0,d.jsx)("span",{className:"text-white/80 text-xs font-medium",children:"0 / 1.000.000 tokens/m\xeas"})]}),(0,d.jsx)("div",{className:"w-full bg-white/10 rounded-full h-2",children:(0,d.jsx)("div",{className:"h-2 rounded-full transition-all bg-emerald-500",style:{width:"0%"}})})]}),(0,d.jsxs)("div",{className:"mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,d.jsx)("span",{className:"text-white/60 text-xs",children:"Vers\xf5es do M\xeas"}),(0,d.jsx)("span",{className:"text-white/80 text-xs font-medium",children:"0 / M\xe1x. 4 vers\xf5es/m\xeas"})]}),(0,d.jsx)("div",{className:"w-full bg-white/10 rounded-full h-2",children:(0,d.jsx)("div",{className:"h-2 rounded-full transition-all bg-emerald-500",style:{width:"0%"}})})]}),(0,d.jsx)("div",{className:"pt-3 border-t border-white/10 space-y-2",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("span",{className:"text-white/60 text-xs",children:"Compartilhar Chat"}),(0,d.jsx)("svg",{className:"w-4 h-4 text-white/40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})})]});let l=-1===a.maxTokens?"Ilimitado":`${a.maxTokens.toLocaleString("pt-BR")} tokens/m\xeas`,m=-1===a.maxVersions?"Ilimitado":`M\xe1x. ${a.maxVersions} vers\xf5es/m\xeas`;return(0,d.jsxs)("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-3 sm:p-4 border border-white/10 shadow-xl w-full",children:[(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-4 pb-4 border-b border-white/10 gap-2",children:[(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2 mb-1 flex-wrap",children:[(0,d.jsx)("h3",{className:"text-white font-bold text-sm sm:text-base truncate",children:a.displayName}),a.isTrial&&(0,d.jsx)("span",{className:"px-2 py-0.5 bg-emerald-500/20 border border-emerald-500/50 rounded text-emerald-400 text-xs font-bold",children:"TRIAL"})]}),a.isTrial&&null!==a.trialDaysLeft&&(0,d.jsxs)("p",{className:"text-emerald-400 text-xs sm:text-sm font-medium mt-1",children:["‚è∞ ",a.trialDaysLeft," ",1===a.trialDaysLeft?"dia":"dias"," restantes"]}),!a.isTrial&&(0,d.jsx)("p",{className:"text-white/60 text-xs mt-1",children:"Plano ativo"})]}),!a.isTrial&&(0,d.jsx)("a",{href:"https://wa.me/5511999999999?text=Ol\xe1! Gostaria de fazer upgrade do meu plano.",target:"_blank",rel:"noopener noreferrer",className:"text-xs sm:text-sm text-emerald-400 hover:text-emerald-300 underline whitespace-nowrap flex-shrink-0",children:"Upgrade"})]}),(0,d.jsxs)("div",{className:"mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,d.jsx)("span",{className:"text-white/60 text-xs",children:"Tokens do M\xeas"}),(0,d.jsxs)("span",{className:"text-white/80 text-xs font-medium",children:[c.tokensUsed.toLocaleString("pt-BR")," / ",l]})]}),(0,d.jsx)("div",{className:"w-full bg-white/10 rounded-full h-2",children:(0,d.jsx)("div",{className:`h-2 rounded-full transition-all ${c.percentage>=90?"bg-red-500":c.percentage>=70?"bg-amber-500":"bg-emerald-500"}`,style:{width:`${Math.min(c.percentage,100)}%`}})})]}),(0,d.jsxs)("div",{className:"mb-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,d.jsx)("span",{className:"text-white/60 text-xs",children:"Vers\xf5es do M\xeas"}),(0,d.jsxs)("span",{className:"text-white/80 text-xs font-medium",children:[g.versionsCount," / ",m]})]}),(0,d.jsx)("div",{className:"w-full bg-white/10 rounded-full h-2",children:(0,d.jsx)("div",{className:`h-2 rounded-full transition-all ${!g.canCreateMore?"bg-red-500":g.versionsCount/(a.maxVersions||1)>=.75?"bg-amber-500":"bg-emerald-500"}`,style:{width:`${-1===a.maxVersions?0:Math.min(g.versionsCount/a.maxVersions*100,100)}%`}})}),!g.canCreateMore&&-1!==a.maxVersions&&(0,d.jsx)("p",{className:"text-red-400 text-xs mt-1",children:"Limite atingido. Fa\xe7a upgrade para criar mais vers\xf5es."})]}),(0,d.jsx)("div",{className:"pt-3 border-t border-white/10 space-y-2",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("span",{className:"text-white/60 text-xs",children:"Compartilhar Chat"}),a.canShareChat?(0,d.jsx)("svg",{className:"w-4 h-4 text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):(0,d.jsx)("svg",{className:"w-4 h-4 text-white/40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})})]})},l=({isMobileOpen:a,onMobileClose:b})=>{let c=(0,f.useRouter)(),j=(0,f.usePathname)(),l=(0,g.U)(),[m,n]=(0,e.useState)(null),[o,p]=(0,e.useState)(null),[q,r]=(0,e.useState)(null),[s,t]=(0,e.useState)(!1);(0,e.useEffect)(()=>{(async()=>{let{data:{session:a}}=await l.auth.getSession();if(a?.user){n(a.user.email||null);try{let a=await (0,h.Rk)();a&&(p(a.full_name||null),r(a.avatar_url||null));let b=await (0,i.jm)();t(b)}catch(a){console.error("Erro ao buscar perfil:",a)}}})();let{data:{subscription:a}}=l.auth.onAuthStateChange((a,b)=>{b?.user?(n(b.user.email||null),(0,h.Rk)().then(a=>{a&&(p(a.full_name||null),r(a.avatar_url||null))}).catch(()=>{}),(0,i.jm)().then(a=>{t(a)}).catch(a=>{console.error("‚ùå [Sidebar] Erro ao verificar admin:",a)})):(n(null),p(null),r(null))}),b=async()=>{try{let a=await (0,h.Rk)();a&&(p(a.full_name||null),r(a.avatar_url||null))}catch(a){console.error("Erro ao atualizar perfil no Sidebar:",a)}};return window.addEventListener("profileUpdated",b),()=>{a.unsubscribe(),window.removeEventListener("profileUpdated",b)}},[]);let u=async()=>{try{await (0,h.CI)(),c.push("/login")}catch(a){console.error("Erro ao fazer logout:",a)}},v=[{label:"Workspace",icon:(0,d.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),path:"/dashboard",active:"/dashboard"===j},{label:"Reposit\xf3rio",icon:(0,d.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),path:"/dashboard/repository",active:"/dashboard/repository"===j},{label:"Configura\xe7\xf5es",icon:(0,d.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),path:"/dashboard/settings",active:"/dashboard/settings"===j},...s?[{label:"Admin Master",icon:(0,d.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),path:"/admin",active:"/admin"===j}]:[]];return(0,d.jsxs)(d.Fragment,{children:[a&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-40 lg:hidden",onClick:b}),(0,d.jsxs)("aside",{className:`
          fixed top-0 left-0 h-full w-72 bg-black border-r border-white/5 z-50 transform transition-transform duration-300 ease-in-out
          ${a?"translate-x-0":"-translate-x-full"}
          lg:translate-x-0 lg:static lg:z-auto
          flex flex-col shadow-2xl
        `,children:[(0,d.jsx)("div",{className:"p-6 border-b border-white/5",children:(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-emerald-400 to-green-500 rounded-lg flex items-center justify-center shadow-lg shadow-emerald-500/30",children:(0,d.jsx)("svg",{className:"w-6 h-6 text-black",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{className:"text-xl font-bold text-white tracking-tight",children:"LaBPrompT"}),(0,d.jsx)("p",{className:"text-xs text-white/40",children:"IA Engineering"})]})]})}),(0,d.jsx)("nav",{className:"flex-1 px-4 py-6 space-y-1 overflow-y-auto",children:v.map(a=>(0,d.jsxs)("button",{onClick:()=>{c.push(a.path),b()},className:`
                w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition-all duration-200 group
                ${a.active?"bg-white/5 text-emerald-400 border border-emerald-500/20 shadow-lg shadow-emerald-500/10":"text-white/60 hover:text-white hover:bg-white/5 border border-transparent"}
              `,children:[(0,d.jsx)("span",{className:a.active?"text-emerald-400":"text-white/40 group-hover:text-emerald-400/60",children:a.icon}),(0,d.jsx)("span",{className:"font-medium text-sm",children:a.label})]},a.path))}),(0,d.jsx)("div",{className:"px-4 pb-4 border-t border-white/5 pt-4",children:(0,d.jsx)(k,{})}),(0,d.jsxs)("div",{className:"p-4 border-t border-white/5",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3 p-3 rounded-lg bg-white/5 border border-white/5 mb-3",children:[(0,d.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-full flex items-center justify-center text-black font-bold text-sm shadow-lg shadow-amber-500/30 overflow-hidden border-2 border-white/20",children:q?(0,d.jsx)("img",{src:q,alt:"Avatar",className:"w-full h-full object-cover"}):o?o.charAt(0).toUpperCase():m?.charAt(0).toUpperCase()||"U"}),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("p",{className:"text-sm font-medium text-white truncate",children:o||"Usu\xe1rio"}),s&&(0,d.jsx)("span",{className:"px-2 py-0.5 bg-gradient-to-r from-amber-500/20 to-yellow-500/20 border border-amber-500/50 rounded text-amber-400 text-xs font-bold",children:"ADMIN"})]}),(0,d.jsx)("p",{className:"text-xs text-white/40 truncate",children:m||""})]})]}),(0,d.jsx)("button",{onClick:u,className:"w-full px-4 py-2.5 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white rounded-lg transition-all duration-200 border border-white/5 hover:border-white/10 text-sm font-medium",children:"Sair"})]})]})]})},m=()=>{let[a,b]=(0,e.useState)(null),[c,f]=(0,e.useState)(!0);if((0,e.useEffect)(()=>{(async()=>{try{let a=await (0,j.Ty)();b(a),a||(console.warn("‚ö†Ô∏è [TrialBanner] Nenhuma informa\xe7\xe3o de plano encontrada. Verifique se a subscription foi criada."),console.warn("\uD83D\uDCA1 [TrialBanner] Execute o script CORRIGIR_SAAS_COMPLETO.sql no Supabase SQL Editor."))}catch(a){console.error("‚ùå [TrialBanner] Erro ao carregar informa\xe7\xf5es do plano:",a),console.error("‚ùå [TrialBanner] Erro detalhado:",a.message,a.stack)}finally{f(!1)}})()},[]),c)return(0,d.jsx)("div",{className:"w-full px-4 py-3 mb-4 rounded-lg border bg-white/5 border-white/10 animate-pulse",children:(0,d.jsx)("div",{className:"h-4 bg-white/10 rounded w-1/3"})});if(!a)return(0,d.jsx)("div",{className:"w-full px-4 py-3 mb-4 rounded-lg border bg-emerald-500/20 border-emerald-500/50",children:(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("svg",{className:"w-5 h-5 text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"})}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("p",{className:"text-emerald-400 font-semibold text-sm",children:"\uD83C\uDF89 Teste Gr\xe1tis de 7 Dias Ativo!"}),(0,d.jsx)("p",{className:"text-white/60 text-xs mt-1",children:"Sua assinatura trial foi criada automaticamente. Aproveite todos os recursos!"})]})]})});let g=a.trialDaysLeft||0,h=g<=3&&g>0,i=1===g;return a.isTrial?(0,d.jsx)("div",{className:`w-full px-3 sm:px-4 md:px-5 py-3 sm:py-3.5 md:py-4 rounded-xl border shadow-lg ${i?"bg-red-500/20 border-red-500/50":h?"bg-amber-500/20 border-amber-500/50":"bg-emerald-500/20 border-emerald-500/50"}`,children:(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[(0,d.jsxs)("div",{className:"flex items-start sm:items-center space-x-2 sm:space-x-3 flex-1 min-w-0",children:[i?(0,d.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-red-400 flex-shrink-0 mt-0.5 sm:mt-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}):h?(0,d.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-amber-400 flex-shrink-0 mt-0.5 sm:mt-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}):(0,d.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-emerald-400 flex-shrink-0 mt-0.5 sm:mt-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"})}),(0,d.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,d.jsx)("p",{className:`font-semibold text-sm sm:text-base leading-tight ${i?"text-red-400":h?"text-amber-400":"text-emerald-400"}`,children:i?"‚ö†Ô∏è \xdaltimo dia do seu trial gr\xe1tis!":h?`‚è∞ Seu trial gr\xe1tis expira em ${g} ${1===g?"dia":"dias"}`:`üéâ Voc\xea est\xe1 no trial gr\xe1tis! ${g} ${1===g?"dia":"dias"} restantes`}),(0,d.jsxs)("p",{className:"text-white/60 text-xs sm:text-sm mt-1 leading-snug",children:[a.displayName," ‚Ä¢ Teste completo da plataforma"]})]})]}),(0,d.jsx)("a",{href:"https://wa.me/5511999999999?text=Ol\xe1! Gostaria de fazer upgrade do meu plano.",target:"_blank",rel:"noopener noreferrer",className:"px-4 sm:px-5 py-2 sm:py-2.5 bg-emerald-500 hover:bg-emerald-600 text-black font-semibold rounded-lg transition-all duration-200 text-xs sm:text-sm whitespace-nowrap shadow-lg shadow-emerald-500/20 hover:shadow-emerald-500/30 hover:scale-105",children:"Fazer Upgrade"})]})}):(0,d.jsx)("div",{className:"w-full px-4 py-3 mb-4 rounded-lg border bg-emerald-500/20 border-emerald-500/50",children:(0,d.jsx)("div",{className:"flex items-center justify-between flex-wrap gap-2",children:(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("svg",{className:"w-5 h-5 text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("p",{className:"font-semibold text-emerald-400",children:["‚úÖ Plano Ativo: ",a.displayName]}),(0,d.jsx)("p",{className:"text-white/60 text-sm mt-1",children:"Aproveite todos os recursos do seu plano"})]})]})})})},n=()=>{let a=(0,g.U)(),[b,c]=(0,e.useState)({hasSession:!1,userId:null,hasSubscription:!1,subscriptionData:null,error:null});if((0,e.useEffect)(()=>{(async()=>{try{let{data:{session:b},error:d}=await a.auth.getSession();if(d)return void c(a=>({...a,error:`Erro de sess\xe3o: ${d.message}`}));if(!b?.user)return void c(a=>({...a,error:"Nenhuma sess\xe3o ativa"}));let e=b.user.id,{data:f,error:g}=await a.from("subscriptions").select("*, plan:plans(*)").eq("user_id",e).eq("is_active",!0).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(g){if(g.message?.includes("infinite recursion")||g.message?.includes("recursion")||"42P17"===g.code){console.error("‚ùå [DiagnosticPanel] Erro de recurs\xe3o infinita nas pol\xedticas RLS:",g),c(a=>({...a,hasSession:!0,userId:e,error:`Erro ao buscar subscription: infinite recursion detected in policy for relation "admin_users". Execute o script CORRIGIR_RLS_ADMIN_USERS_FINAL.sql no Supabase SQL Editor para corrigir. (‚ö†Ô∏è Use o arquivo FINAL, n\xe3o o antigo!)`}));return}if("PGRST116"!==g.code){console.error("‚ùå [DiagnosticPanel] Erro ao buscar subscription:",g),c(a=>({...a,hasSession:!0,userId:e,error:`Erro ao buscar subscription: ${g.message}`}));return}}c({hasSession:!0,userId:e,hasSubscription:!!f,subscriptionData:f,error:null})}catch(a){console.error("‚ùå [DiagnosticPanel] Erro nos diagn\xf3sticos:",a),c(b=>({...b,error:a.message||"Erro desconhecido"}))}})()},[]),!b.hasSession)return(0,d.jsxs)("div",{className:"bg-red-500/20 border border-red-500/50 rounded-xl p-4 mb-4",children:[(0,d.jsx)("p",{className:"text-red-400 font-semibold",children:"‚ö†Ô∏è Nenhuma sess\xe3o ativa"}),(0,d.jsx)("p",{className:"text-red-300 text-sm mt-1",children:b.error})]});if(b.error){let a=b.error.includes("infinite recursion");return(0,d.jsx)("div",{className:"bg-red-500/20 border border-red-500/50 rounded-xl p-4 mb-4",children:(0,d.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,d.jsx)("svg",{className:"w-5 h-5 text-red-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("p",{className:"text-red-400 font-semibold mb-2",children:"‚ùå Erro nos Diagn\xf3sticos"}),(0,d.jsx)("p",{className:"text-red-300 text-sm mb-2",children:b.error}),a&&(0,d.jsxs)("div",{className:"mt-3 p-3 bg-white/5 rounded-lg border border-white/10",children:[(0,d.jsx)("p",{className:"text-white/80 text-xs font-semibold mb-2",children:"\uD83D\uDD27 Como corrigir:"}),(0,d.jsxs)("ol",{className:"text-white/60 text-xs space-y-1 list-decimal list-inside",children:[(0,d.jsx)("li",{children:"Acesse o Supabase Dashboard: https://supabase.com/dashboard"}),(0,d.jsx)("li",{children:"V\xe1 em SQL Editor ‚Üí New query"}),(0,d.jsxs)("li",{children:["Copie o conte\xfado do arquivo ",(0,d.jsx)("code",{className:"bg-white/10 px-1 rounded",children:"CORRIGIR_RLS_ADMIN_USERS_FINAL.sql"})]}),(0,d.jsx)("li",{children:"Cole e execute (Ctrl+Enter ou Cmd+Enter)"}),(0,d.jsx)("li",{children:"Recarregue esta p\xe1gina"})]})]}),(0,d.jsxs)("p",{className:"text-white/40 text-xs mt-3",children:["User ID: ",(0,d.jsx)("code",{className:"bg-white/10 px-1 rounded",children:b.userId})]})]})]})})}return b.hasSubscription?null:(0,d.jsx)("div",{className:"bg-amber-500/20 border border-amber-500/50 rounded-xl p-4 mb-4",children:(0,d.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,d.jsx)("svg",{className:"w-5 h-5 text-amber-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("p",{className:"text-amber-400 font-semibold mb-2",children:"‚ö†Ô∏è Nenhuma Subscription Encontrada"}),(0,d.jsx)("p",{className:"text-white/80 text-sm mb-2",children:"Voc\xea n\xe3o possui uma subscription ativa. Isso pode acontecer se:"}),(0,d.jsxs)("ul",{className:"text-white/60 text-xs mb-3 list-disc list-inside space-y-1",children:[(0,d.jsx)("li",{children:"O trigger `on_auth_user_created` n\xe3o foi executado"}),(0,d.jsx)("li",{children:"A subscription foi deletada ou desativada"}),(0,d.jsx)("li",{children:"Voc\xea precisa criar uma subscription manualmente"})]}),(0,d.jsxs)("div",{className:"mt-3 p-3 bg-white/5 rounded-lg border border-white/10",children:[(0,d.jsx)("p",{className:"text-white/80 text-xs font-semibold mb-2",children:"\uD83D\uDD27 Solu\xe7\xe3o:"}),(0,d.jsxs)("p",{className:"text-white/60 text-xs mb-2",children:["Execute o script ",(0,d.jsx)("code",{className:"bg-white/10 px-1 rounded",children:"VERIFICAR_SUBSCRIPTIONS.sql"})," ou ",(0,d.jsx)("code",{className:"bg-white/10 px-1 rounded",children:"CORRIGIR_SAAS_COMPLETO.sql"})," no Supabase SQL Editor."]})]}),(0,d.jsxs)("p",{className:"text-white/40 text-xs mt-3",children:["User ID: ",(0,d.jsx)("code",{className:"bg-white/10 px-1 rounded",children:b.userId})]})]})]})})};function o({children:a}){let[b,c]=(0,e.useState)(!1);return(0,d.jsxs)("div",{className:"flex h-screen w-screen overflow-hidden bg-gradient-to-br from-black via-gray-900 to-black",children:[(0,d.jsx)(l,{isMobileOpen:b,onMobileClose:()=>c(!1)}),(0,d.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,d.jsxs)("header",{className:"lg:hidden sticky top-0 z-40 bg-black/95 backdrop-blur-md border-b border-white/10 px-4 py-3 flex items-center justify-between shadow-lg",children:[(0,d.jsx)("button",{onClick:()=>c(!0),className:"p-2 rounded-lg text-white/70 hover:text-white hover:bg-white/10 transition-all duration-200","aria-label":"Abrir menu",children:(0,d.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-emerald-400 to-green-500 rounded-lg flex items-center justify-center shadow-lg shadow-emerald-500/30",children:(0,d.jsx)("svg",{className:"w-5 h-5 text-black",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),(0,d.jsx)("span",{className:"text-white font-bold text-lg tracking-tight",children:"LaBPrompT"})]}),(0,d.jsx)("div",{className:"w-10"})]}),(0,d.jsx)("main",{className:"flex-1 overflow-y-auto overflow-x-hidden bg-black",children:(0,d.jsxs)("div",{className:"w-full max-w-[1920px] mx-auto px-4 md:px-6 lg:px-8 xl:px-10 py-4 md:py-6 lg:py-8",children:[(0,d.jsx)("div",{className:"mb-4",children:(0,d.jsx)(n,{})}),(0,d.jsx)("div",{className:"mb-4 md:mb-5 lg:mb-6",children:(0,d.jsx)(m,{})}),(0,d.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 md:gap-5 lg:gap-6",children:(0,d.jsx)("div",{className:"lg:col-span-12",children:a})})]})})]})]})}},10643:(a,b,c)=>{"use strict";c.d(b,{U:()=>e});var d=c(36605);function e(){let a=process.env.NEXT_PUBLIC_SUPABASE_URL,b=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;return a&&b?(0,d.createBrowserClient)(a||"",b||"",{db:{schema:"public"},auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},global:{headers:{"x-client-info":"labprompt-nextjs"}}}):(console.warn("‚ö†Ô∏è Vari\xe1veis de ambiente do Supabase n\xe3o configuradas. O cliente Supabase pode n\xe3o funcionar corretamente."),(0,d.createBrowserClient)("https://placeholder.supabase.co","placeholder",{db:{schema:"public"},auth:{persistSession:!1}}))}},21871:(a,b,c)=>{Promise.resolve().then(c.bind(c,69694))},65812:(a,b,c)=>{"use strict";c.d(b,{It:()=>n,Ty:()=>k,du:()=>p,ex:()=>m,gg:()=>f,nG:()=>o,oo:()=>l,vQ:()=>j,x8:()=>g,zN:()=>i});var d=c(36369);async function e(){try{let{data:{session:a}}=await d.ND.auth.getSession();if(!a?.user)return null;let{data:b,error:c}=await d.ND.from("subscriptions").select(`
        *,
        plan:plans(*)
      `).eq("user_id",a.user.id).eq("is_active",!0).order("created_at",{ascending:!1}).limit(1).single();if(c){if("PGRST116"===c.code)return console.warn("‚ö†Ô∏è [getCurrentSubscription] Nenhuma assinatura encontrada para o usu\xe1rio. Verifique se o trigger est\xe1 criando subscriptions automaticamente."),null;throw console.error("‚ùå [getCurrentSubscription] Erro ao buscar subscription:",c),c}return b}catch(a){return console.error("‚ùå [getCurrentSubscription] Erro ao buscar subscription:",a),null}}async function f(){try{let a=await e();if(!a)return{allowed:!1,reason:"Nenhuma assinatura ativa encontrada. Por favor, entre em contato com o suporte."};if(!a.plan?.can_share_chat)return{allowed:!1,reason:"Compartilhamento de chat n\xe3o dispon\xedvel no plano Trial. Fa\xe7a upgrade para acessar este recurso."};return{allowed:!0}}catch(a){return console.error("‚ùå Erro ao verificar compartilhamento:",a),{allowed:!1,reason:"Erro ao verificar permiss\xe3o. Tente novamente."}}}async function g(a){try{let{data:{session:b}}=await d.ND.auth.getSession();if(!b?.user)return!1;let{data:c,error:e}=await d.ND.rpc("check_user_access",{p_user_id:b.user.id,p_feature:a});if(e)return console.error("‚ùå Erro ao verificar acesso:",e),!1;return!0===c}catch(a){return console.error("‚ùå Erro ao verificar acesso:",a),!1}}async function h(a,b,c,e,f){try{let{data:{session:g}}=await d.ND.auth.getSession();if(!g?.user)return console.error("‚ùå Usu\xe1rio n\xe3o autenticado para registrar uso"),!1;let{error:h}=await d.ND.rpc("track_token_usage",{p_user_id:g.user.id,p_tokens_used:a,p_usage_type:b,p_model_used:c,p_prompt_id:e||null,p_version_id:f||null});if(h)return console.error("‚ùå Erro ao registrar uso de tokens:",h),!1;return!0}catch(a){return console.error("‚ùå Erro ao registrar uso de tokens:",a),!1}}async function i(){try{let a=await e();if(!a)return{tokensUsed:0,tokensLimit:1e6,percentage:0};let{data:{session:b}}=await d.ND.auth.getSession();if(!b?.user)return{tokensUsed:0,tokensLimit:a.plan?.max_tokens_per_month||1e6,percentage:0};let c=new Date,f=c.getFullYear(),g=c.getMonth()+1,{data:h,error:i}=await d.ND.from("usage_tracking").select("tokens_used").eq("user_id",b.user.id).eq("usage_year",f).eq("usage_month",g);if(i)return console.error("‚ùå Erro ao buscar uso:",i),{tokensUsed:0,tokensLimit:a.plan?.max_tokens_per_month||1e6,percentage:0};let j=h?.reduce((a,b)=>a+(b.tokens_used||0),0)||0,k=a.plan?.max_tokens_per_month||1e6,l=k>0?Math.round(j/k*100):0;return{tokensUsed:j,tokensLimit:k,percentage:l}}catch(a){return console.error("‚ùå Erro ao buscar uso do m\xeas:",a),{tokensUsed:0,tokensLimit:1e6,percentage:0}}}async function j(){try{let a=await e();if(!a)return{versionsCount:0,versionsLimit:4,canCreateMore:!0};let{data:{session:b}}=await d.ND.auth.getSession();if(!b?.user)return{versionsCount:0,versionsLimit:a.plan?.max_prompt_versions||4,canCreateMore:!0};let c=new Date,f=new Date(c.getFullYear(),c.getMonth(),1),{data:g,error:h}=await d.ND.from("prompts").select("id").eq("user_id",b.user.id);if(h||!g?.length)return{versionsCount:0,versionsLimit:a.plan?.max_prompt_versions||4,canCreateMore:!0};let i=g.map(a=>a.id),{data:j,error:k}=await d.ND.from("prompt_versions").select("id").in("prompt_id",i).gte("created_at",f.toISOString());if(k)return console.error("‚ùå Erro ao contar vers\xf5es:",k),{versionsCount:0,versionsLimit:a.plan?.max_prompt_versions||4,canCreateMore:!0};let l=j?.length||0,m=a.plan?.max_prompt_versions||4;return{versionsCount:l,versionsLimit:m,canCreateMore:-1===m||l<m}}catch(a){return console.error("‚ùå Erro ao contar vers\xf5es:",a),{versionsCount:0,versionsLimit:4,canCreateMore:!0}}}async function k(){let a=await e();if(!a||!a.plan)return console.warn("‚ö†Ô∏è [getCurrentPlanInfo] Nenhuma subscription ou plano encontrado."),null;let b="trial"===a.status,c=null;if(b&&a.trial_ends_at){let b=new Date(a.trial_ends_at),d=new Date;c=Math.max(0,Math.ceil((b.getTime()-d.getTime())/864e5))}return{planName:a.plan.name,displayName:a.plan.display_name,isTrial:b,trialDaysLeft:c,canShareChat:a.plan.can_share_chat,maxVersions:a.plan.max_prompt_versions,maxTokens:a.plan.max_tokens_per_month}}async function l(a){try{let b=await e();if(!b)return{allowed:!1,reason:"Nenhuma assinatura ativa encontrada. Por favor, entre em contato com o suporte."};if(b.plan?.max_tokens_per_month===-1)return{allowed:!0};let c=await i();if(-1===c.tokensLimit)return{allowed:!0};if(c.tokensUsed+a>c.tokensLimit){let a=Math.max(0,c.tokensLimit-c.tokensUsed);return{allowed:!1,reason:`Limite de tokens excedido. Voc\xea tem ${a.toLocaleString("pt-BR")} tokens restantes este m\xeas. Upgrade seu plano para continuar.`}}return{allowed:!0}}catch(a){return console.error("‚ùå Erro ao verificar tokens:",a),{allowed:!1,reason:"Erro ao verificar limite de tokens. Tente novamente."}}}async function m(a,b="prompt_generation",c="gemini-2.5-flash",d,e){return h(a,b,c,d,e)}async function n(){let[a,b,c]=await Promise.all([k(),j(),i()]);return{canCreateVersion:b.canCreateMore,canShareChat:a?.canShareChat||!1,versionsCount:b.versionsCount,versionsLimit:b.versionsLimit,tokensUsed:c.tokensUsed,tokensLimit:c.tokensLimit,trialDaysLeft:a?.trialDaysLeft||null}}async function o(){if(!await g("create_version")){let a=await j();return{allowed:!1,reason:`Limite de vers\xf5es atingido! Voc\xea j\xe1 criou ${a.versionsCount} de ${a.versionsLimit} vers\xf5es permitidas no seu plano este m\xeas. Upgrade para Premium para criar vers\xf5es ilimitadas.`}}return{allowed:!0}}async function p(){}},69694:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\WINDOWS\\\\OneDrive\\\\Apps\\\\LABPROMPT\\\\labprompt\\\\app\\\\dashboard\\\\layout.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\WINDOWS\\OneDrive\\Apps\\LABPROMPT\\labprompt\\app\\dashboard\\layout.tsx","default")},84680:(a,b,c)=>{"use strict";c.d(b,{$H:()=>i,JE:()=>g,QB:()=>h,ZZ:()=>k,_X:()=>f,dE:()=>n,jm:()=>e,nV:()=>j,vD:()=>m,xj:()=>l});var d=c(36369);async function e(){try{let{data:{session:a}}=await d.ND.auth.getSession();if(!a?.user)return!1;let b=a.user.email,{data:c,error:e}=await d.ND.from("admin_users").select("role, email, is_active").eq("user_id",a.user.id).eq("is_active",!0).maybeSingle();if(e&&"PGRST116"!==e.code){if(console.error("‚ùå [isSuperAdmin] Erro na query:",e),"brunocostaads23@gmail.com"===b){console.warn("‚ö†Ô∏è [isSuperAdmin] Admin n\xe3o encontrado na tabela, mas email \xe9 admin master. Criando registro...");try{let{error:c}=await d.ND.from("admin_users").insert({user_id:a.user.id,email:b,role:"super_admin",can_manage_tenants:!0,can_manage_subscriptions:!0,can_view_analytics:!0,is_active:!0});if(!c)return!0}catch(a){console.error("‚ùå [isSuperAdmin] Erro ao criar registro de admin:",a)}}return!1}if(!c){if(console.warn("‚ö†Ô∏è [isSuperAdmin] Nenhum registro de admin encontrado"),"brunocostaads23@gmail.com"===b)return!0;return!1}return"super_admin"===c.role}catch(a){return console.error("‚ùå [isSuperAdmin] Erro ao verificar super admin:",a),console.error("‚ùå [isSuperAdmin] Stack:",a.stack),!1}}async function f(){try{let{data:a,error:b}=await d.ND.from("tenants").select("*").order("created_at",{ascending:!1}).limit(50);if(b)throw b;return a||[]}catch(a){throw console.error("‚ùå Erro ao listar tenants:",a),a}}async function g(a){try{let{data:b,error:c}=await d.ND.from("tenants").insert({name:a.name,slug:a.slug,email:a.email||null,phone:a.phone||null,is_active:!0}).select().single();if(c)throw c;return b}catch(a){throw console.error("‚ùå Erro ao criar tenant:",a),a}}async function h(a,b){try{let{data:c,error:e}=await d.ND.from("tenants").update(b).eq("id",a).select().single();if(e)throw e;return c}catch(a){throw console.error("‚ùå Erro ao atualizar tenant:",a),a}}async function i(){try{let{data:a,error:b}=await d.ND.from("subscriptions").select(`
        *,
        plan:plans(*),
        user:profiles(id, email, full_name)
      `).order("created_at",{ascending:!1}).limit(50);if(b)throw b;return a||[]}catch(a){throw console.error("‚ùå Erro ao listar subscriptions:",a),a}}async function j(a,b){try{let{data:c,error:e}=await d.ND.from("subscriptions").update(b).eq("id",a).select(`
        *,
        plan:plans(*)
      `).single();if(e)throw e;return c}catch(a){throw console.error("‚ùå Erro ao atualizar subscription:",a),a}}async function k(){try{let{data:a,error:b}=await d.ND.from("profiles").select(`
        id, 
        email, 
        full_name,
        subscriptions (
          id,
          plan_id,
          status,
          trial_ends_at,
          subscription_ends_at,
          is_active
        )
      `).order("created_at",{ascending:!1}).limit(50);if(b)throw b;if(!a)return[];return a.map(a=>{let b=a.subscriptions?.find(a=>!0===a.is_active)||null;return{id:a.id,email:a.email,full_name:a.full_name,subscription:b?{id:b.id,plan_id:b.plan_id,status:b.status,trial_ends_at:b.trial_ends_at,subscription_ends_at:b.subscription_ends_at}:null}})}catch(a){throw console.error("‚ùå Erro ao listar usu\xe1rios:",a),a}}async function l(a){try{let{data:b,error:c}=await d.ND.auth.admin.createUser({email:a.email,password:a.password,email_confirm:!0,user_metadata:{full_name:a.fullName}});if(c)throw console.error("‚ùå Erro ao criar usu\xe1rio:",c),Error(`Erro ao criar usu\xe1rio: ${c.message}`);if(!b.user)throw Error("Usu\xe1rio n\xe3o foi criado corretamente");let e=b.user.id,{error:f}=await d.ND.from("profiles").upsert({id:e,email:a.email,full_name:a.fullName});f&&console.warn("‚ö†Ô∏è Erro ao criar perfil (pode j\xe1 existir):",f);let{data:g,error:h}=await d.ND.from("plans").select("id").eq("name","premium").single();if(h||!g)throw console.error("‚ùå Plano premium n\xe3o encontrado:",h),Error("Plano premium n\xe3o encontrado no banco de dados");let{error:i}=await d.ND.from("subscriptions").insert({user_id:e,plan_id:g.id,status:"active",is_active:!0,subscription_started_at:new Date().toISOString()});if(i)throw console.error("‚ùå Erro ao criar subscription:",i),Error(`Erro ao criar subscription premium: ${i.message}`);return{userId:e,message:`Usu\xe1rio ${a.email} criado com sucesso e subscription premium ativada!`}}catch(a){throw console.error("‚ùå Erro ao criar usu\xe1rio com premium:",a),a}}async function m(a,b){try{let{data:c,error:e}=await d.ND.from("plans").select("id, trial_days").eq("name",b).single();if(e||!c)throw Error(`Plano ${b} n\xe3o encontrado`);await d.ND.from("subscriptions").update({is_active:!1}).eq("user_id",a);let f={user_id:a,plan_id:c.id,is_active:!0};if("trial"===b&&c.trial_days){let a=new Date,b=new Date(a);b.setDate(b.getDate()+c.trial_days),f.status="trial",f.trial_started_at=a.toISOString(),f.trial_ends_at=b.toISOString()}else f.status="active",f.subscription_started_at=new Date().toISOString();let{error:g}=await d.ND.from("subscriptions").insert(f);if(g)throw Error(`Erro ao criar nova subscription: ${g.message}`);return{message:`Plano alterado para ${"premium"===b?"Premium":"Trial"} com sucesso!`}}catch(a){throw console.error("‚ùå Erro ao alterar plano:",a),a}}async function n(){try{let[{count:a},{count:b},{count:c},{count:e},{count:f}]=await Promise.all([d.ND.from("profiles").select("*",{count:"exact",head:!0}),d.ND.from("subscriptions").select("*",{count:"exact",head:!0}).eq("is_active",!0),d.ND.from("subscriptions").select("*",{count:"exact",head:!0}).eq("is_active",!0).eq("status","trial"),d.ND.from("subscriptions").select("*",{count:"exact",head:!0}).eq("is_active",!0).eq("status","active"),d.ND.from("tenants").select("*",{count:"exact",head:!0})]);return{totalUsers:a||0,activeSubscriptions:b||0,trialUsers:c||0,premiumUsers:e||0,totalTenants:f||0}}catch(a){throw console.error("‚ùå Erro ao buscar estat\xedsticas:",a),a}}}};