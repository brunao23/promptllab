"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[217],{3217:(e,r,o)=>{o.d(r,{$1:()=>C,CI:()=>_,D$:()=>A,F4:()=>E,HK:()=>x,Ir:()=>b,Mr:()=>P,ND:()=>f,Rk:()=>h,V1:()=>U,XH:()=>k,Zm:()=>q,bi:()=>R,ec:()=>g,ji:()=>S,k0:()=>N,n3:()=>T,r7:()=>v,sK:()=>y,tO:()=>z,x:()=>D});var t,a,i,n,s,d,l=o(3503),c=o(8231),m=o(5704);let u=void 0!==m&&(null==(t=m.env)?void 0:t.NEXT_PUBLIC_SUPABASE_URL)||(null==(i=window.__NEXT_DATA__)||null==(a=i.env)?void 0:a.NEXT_PUBLIC_SUPABASE_URL)||"",p=void 0!==m&&(null==(n=m.env)?void 0:n.NEXT_PUBLIC_SUPABASE_ANON_KEY)||(null==(d=window.__NEXT_DATA__)||null==(s=d.env)?void 0:s.NEXT_PUBLIC_SUPABASE_ANON_KEY)||"";u&&p||(console.error("❌ ERRO: Vari\xe1veis de ambiente do Supabase n\xe3o configuradas!\n⚠️ IMPORTANTE: Este projeto usa Next.js, ent\xe3o voc\xea DEVE usar:\n   - NEXT_PUBLIC_SUPABASE_URL\n   - NEXT_PUBLIC_SUPABASE_ANON_KEY\nConfigure na Vercel: Settings → Environment Variables\n"+"URL atual: ".concat(u||"VAZIO","\n")+"Key atual: ".concat(p?p.substring(0,20)+"...":"VAZIO","\n")),void 0!==m&&(console.error("⚠️ Aplica\xe7\xe3o em produ\xe7\xe3o sem configura\xe7\xe3o do Supabase!"),console.error("⚠️ Verifique se as vari\xe1veis est\xe3o com prefixo NEXT_PUBLIC_ na Vercel!")));let f=(0,l.UU)(u||"https://placeholder.supabase.co",p||"placeholder-key",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:window.localStorage}});async function _(){let{error:e}=await f.auth.signOut();if(e)throw e}async function w(){let{data:{user:e},error:r}=await f.auth.getUser();if(r)throw r;return e}async function h(){let e=await w();if(!e)return null;let{data:r,error:o}=await f.from("profiles").select("*").eq("id",e.id).single();if(o){if("PGRST116"===o.code)return null;throw console.error("❌ [getCurrentProfile] Erro ao buscar perfil:",o),o}return r}async function v(e){let r=await w();if(!r)throw Error("Usu\xe1rio n\xe3o autenticado");let o={};if(void 0!==e.full_name){let r=(0,c.jZ)(e.full_name.trim());r.length>0?o.full_name=r:o.full_name=""}let{data:t,error:a}=await f.from("profiles").select("id").eq("id",r.id).single();if(a&&"PGRST116"!==a.code)throw console.error("❌ [updateProfile] Erro ao verificar perfil:",a),a;if(!t){var i,n;let{data:e}=await f.auth.getSession(),t=(null==e||null==(n=e.session)||null==(i=n.user)?void 0:i.email)||"",{data:a,error:s}=await f.from("profiles").insert({id:r.id,email:t,full_name:o.full_name||""}).select().single();if(s)throw console.error("❌ [updateProfile] Erro ao criar perfil:",s),s;return a}let{data:s,error:d}=await f.from("profiles").update(o).eq("id",r.id).select().single();if(d)throw console.error("❌ [updateProfile] Erro ao atualizar perfil:",d),d;return s}async function g(e,r){let o=await w();if(!o)throw Error("Usu\xe1rio n\xe3o autenticado");let{data:t,error:a}=await f.auth.signInWithPassword({email:o.email,password:e});if(a||!t.user)throw Error("Senha atual incorreta");let{error:i}=await f.auth.updateUser({password:r});if(i)throw console.error("❌ [changePassword] Erro ao atualizar senha:",i),i}async function E(e){let r=await w();if(!r)throw Error("Usu\xe1rio n\xe3o autenticado");if(!e.type.startsWith("image/"))throw Error("Apenas imagens s\xe3o permitidas");if(e.size>5242880)throw Error("A imagem deve ter no m\xe1ximo 5MB");let o=e.name.split(".").pop(),t="".concat(r.id,"-").concat(Date.now(),".").concat(o),a="avatars/".concat(t),{data:i,error:n}=await f.storage.from("avatars").upload(a,e,{cacheControl:"3600",upsert:!0});if(n&&(n.message.includes("Bucket not found")||n.message.includes("not found")||n.message.includes("does not exist")))throw console.error('❌ [uploadAvatar] Bucket "avatars" n\xe3o encontrado no Supabase Storage'),Error('O bucket de armazenamento n\xe3o foi configurado.\n\nPor favor, crie o bucket "avatars" no Supabase Storage:\n1. Acesse o Dashboard do Supabase\n2. V\xe1 para Storage → Create bucket\n3. Nome: avatars\n4. P\xfablico: Sim\n5. Clique em Create\n\nAp\xf3s criar o bucket, tente novamente. Consulte o arquivo CRIAR_BUCKET_AVATARS.md para mais detalhes.');if(n){if(console.error("❌ [uploadAvatar] Erro ao fazer upload:",n),n.message.includes("File size exceeds")||n.message.includes("size"))throw Error("O arquivo \xe9 muito grande. O tamanho m\xe1ximo permitido \xe9 5MB.");if(n.message.includes("Invalid file type")||n.message.includes("file type"))throw Error("Tipo de arquivo inv\xe1lido. Apenas imagens (PNG, JPG, GIF, WEBP) s\xe3o permitidas.");if(n.message.includes("Unauthorized")||n.message.includes("permission")||n.message.includes("403"))throw Error('Erro de permiss\xe3o. Verifique se o bucket "avatars" est\xe1 configurado como p\xfablico no Supabase Storage.');else if(n.message.includes("duplicate")||n.message.includes("already exists")){let t="".concat(r.id,"-").concat(Date.now(),"-").concat(Math.random().toString(36).substring(7),".").concat(o),a="avatars/".concat(t),i=await f.storage.from("avatars").upload(a,e,{cacheControl:"3600",upsert:!1});if(i.error)throw Error(i.error.message||"Erro ao fazer upload da imagem. Tente novamente.");let{data:{publicUrl:n}}=f.storage.from("avatars").getPublicUrl(a),{error:s}=await f.from("profiles").update({avatar_url:n}).eq("id",r.id);return s&&console.error("❌ [uploadAvatar] Erro ao atualizar perfil:",s),n}throw Error(n.message||"Erro ao fazer upload da imagem. Tente novamente ou contate o suporte.")}let{data:{publicUrl:s}}=f.storage.from("avatars").getPublicUrl(a),{error:d}=await f.from("profiles").update({avatar_url:s}).eq("id",r.id);return d&&console.error("❌ [uploadAvatar] Erro ao atualizar perfil:",d),s}async function x(e,r,o){let t=await w();if(!t)throw Error("Usu\xe1rio n\xe3o autenticado");if(!o){let e=await D();e&&(o=e.id)}let a=r?(0,c.jZ)(r.trim(),200):(0,c.jZ)(e.persona.substring(0,50),200),i=(0,c.A_)(e.persona,1e4);if(!i.valid)throw Error(i.error||"Persona inv\xe1lida");let n=(0,c.A_)(e.objetivo,5e3);if(!n.valid)throw Error(n.error||"Objetivo inv\xe1lido");let s=(0,c.A_)(e.contextoNegocio||"",1e4),d=(0,c.A_)(e.contexto||"",1e4),l=e.regras.map(e=>(0,c.jZ)(e.trim(),1e3)).filter(e=>e.length>0);if(!["text","markdown","json","xml","yaml"].includes(e.formatoSaida))throw Error("Formato de sa\xedda inv\xe1lido");if(!["markdown","json"].includes(e.masterPromptFormat))throw Error("Formato do prompt mestre inv\xe1lido");if(e.promptSize<500||e.promptSize>1e5)throw Error("Tamanho do prompt deve estar entre 500 e 100000 caracteres");let{data:m,error:u}=await f.from("profiles").select("id").eq("id",t.id).single();if(u)throw console.error("❌ [createPrompt] Erro ao verificar profile:",u),u;if(!m)throw console.error("❌ [createPrompt] Profile n\xe3o encontrado para user_id:",t.id),Error("Perfil do usu\xe1rio n\xe3o encontrado. Por favor, fa\xe7a logout e login novamente.");let{data:p,error:_}=await f.from("prompts").insert({user_id:m.id,workspace_id:o||null,title:a,persona:i.sanitized||"",objetivo:n.sanitized||"",contexto_negocio:s.sanitized||"",contexto:d.sanitized||"",regras:l,formato_saida:e.formatoSaida,master_prompt_format:e.masterPromptFormat,estrutura_saida:(0,c.jZ)(e.estruturaSaida||"",5e3),prompt_size:e.promptSize}).select().single();if(_)throw console.error("❌ ERRO ao salvar prompt no banco:",{message:_.message,details:_.details,hint:_.hint,code:_.code}),_;let h=p.id;if(e.exemplos.length>0){let{error:r}=await f.from("few_shot_examples").insert(e.exemplos.map((e,r)=>({prompt_id:h,user_text:e.user,agent_text:e.agent,order_index:r})));if(r)throw console.error("❌ Erro ao salvar exemplos:",r),r}if(e.variaveisDinamicas.length>0){let{error:r}=await f.from("variaveis_dinamicas").insert(e.variaveisDinamicas.map((e,r)=>({prompt_id:h,chave:e.chave,valor:e.valor,order_index:r})));if(r)throw console.error("❌ Erro ao salvar vari\xe1veis:",r),r}if(e.ferramentas.length>0){let{error:r}=await f.from("ferramentas").insert(e.ferramentas.map((e,r)=>({prompt_id:h,nome:e.nome,descricao:e.descricao,order_index:r})));if(r)throw console.error("❌ Erro ao salvar ferramentas:",r),r}if(e.fluxos.length>0){let{error:r}=await f.from("fluxos").insert(e.fluxos.map((e,r)=>({prompt_id:h,nome:e.nome,tipo_prompt:e.tipoPrompt,objetivo:e.objetivo,base_conhecimento_rag:e.baseConhecimentoRAG,few_shot_examples:e.fewShotExamples,reforcar_cot:e.reforcarCoT,ativar_guardrails:e.ativarGuardrails,order_index:r})));if(r)throw console.error("❌ Erro ao salvar fluxos:",r),r}return p}async function S(e){if(!await w())throw Error("Usu\xe1rio n\xe3o autenticado");let r=await h();if(!r)throw Error("Perfil do usu\xe1rio n\xe3o encontrado");let o=f.from("prompts").select("*").eq("user_id",r.id);e&&(o=o.eq("workspace_id",e));let{data:t,error:a}=await o.eq("is_active",!0).order("created_at",{ascending:!1}).limit(20);if(a)throw console.error("❌ [getUserPrompts] Erro ao buscar prompts:",a),a;let i=t||[];return i.length>0&&i.forEach((e,r)=>{}),i}async function b(e){let r=await w();if(!r)throw Error("Usu\xe1rio n\xe3o autenticado");if(!(0,c.aJ)(e))throw Error("ID de prompt inv\xe1lido");let{data:o,error:t}=await f.from("profiles").select("id").eq("id",r.id).single();if(t)throw console.error("❌ [deletePrompt] Erro ao verificar profile:",t),t;if(!o)throw Error("Perfil do usu\xe1rio n\xe3o encontrado");let{error:a}=await f.from("prompts").update({is_active:!1}).eq("id",e).eq("user_id",o.id);if(a)throw console.error("❌ [deletePrompt] Erro ao deletar prompt:",a),a}async function k(e){let r=await w();if(!r)throw Error("Usu\xe1rio n\xe3o autenticado");if(!(0,c.aJ)(e))throw Error("ID de prompt inv\xe1lido");let{data:o,error:t}=await f.from("profiles").select("id").eq("id",r.id).single();if(t)throw console.error("❌ [getPrompt] Erro ao verificar profile:",t),t;if(!o)throw console.error("❌ [getPrompt] Profile n\xe3o encontrado para user_id:",r.id),Error("Perfil do usu\xe1rio n\xe3o encontrado");let{data:a,error:i}=await f.from("prompts").select("*").eq("id",e).eq("user_id",o.id).single();if(i)throw i;if(!a)throw Error("Prompt n\xe3o encontrado");let[n,s,d,l]=await Promise.all([f.from("few_shot_examples").select("*").eq("prompt_id",e).order("order_index"),f.from("variaveis_dinamicas").select("*").eq("prompt_id",e).order("order_index"),f.from("ferramentas").select("*").eq("prompt_id",e).order("order_index"),f.from("fluxos").select("*").eq("prompt_id",e).order("order_index")]),m={persona:a.persona,objetivo:a.objetivo,contextoNegocio:a.contexto_negocio||"",contexto:a.contexto||"",regras:a.regras||[],exemplos:(n.data||[]).map(e=>({id:e.id,user:e.user_text,agent:e.agent_text})),variaveisDinamicas:(s.data||[]).map(e=>({id:e.id,chave:e.chave,valor:e.valor})),ferramentas:(d.data||[]).map(e=>({id:e.id,nome:e.nome,descricao:e.descricao})),formatoSaida:a.formato_saida,masterPromptFormat:a.master_prompt_format,estruturaSaida:a.estrutura_saida||"",fluxos:(l.data||[]).map(e=>({id:e.id,nome:e.nome,tipoPrompt:e.tipo_prompt||"",objetivo:e.objetivo||"",baseConhecimentoRAG:e.base_conhecimento_rag||"",fewShotExamples:e.few_shot_examples||"",reforcarCoT:e.reforcar_cot||!1,ativarGuardrails:e.ativar_guardrails||!1})),promptSize:a.prompt_size||5e3};return{prompt:a,promptData:m}}async function A(e,r){if(!await w())throw Error("Usu\xe1rio n\xe3o autenticado");if(!(0,c.aJ)(e))throw Error("ID de prompt inv\xe1lido");let o=(0,c.A_)(r.content,1e5);if(!o.valid)throw Error(o.error||"Conte\xfado da vers\xe3o inv\xe1lido");let{data:t}=await f.from("prompt_versions").select("version_number").eq("prompt_id",e).order("version_number",{ascending:!1}).limit(1).single(),a=t?t.version_number+1:1,{data:i,error:n}=await f.from("prompt_versions").insert({prompt_id:e,version_number:a,content:o.sanitized||"",format:r.format,master_format:r.masterFormat,source_data:(0,c.Zm)(r.sourceData)}).select().single();if(n)throw console.error("❌ ERRO ao salvar vers\xe3o no banco:",{message:n.message,details:n.details,hint:n.hint,code:n.code}),n;return{id:i.id,version:i.version_number,content:i.content,format:i.format,masterFormat:i.master_format,timestamp:new Date(i.created_at).toLocaleString("pt-BR"),sourceData:i.source_data}}async function P(e){if(!(0,c.aJ)(e))throw Error("ID de prompt inv\xe1lido");let r=await h();if(!r)throw Error("Perfil do usu\xe1rio n\xe3o encontrado");let{data:o,error:t}=await f.from("prompt_versions").select("*, prompts!inner(user_id)").eq("prompts.user_id",r.id).eq("prompt_id",e).order("version_number",{ascending:!1}).limit(50);if(t)throw console.error("❌ Erro ao buscar vers\xf5es:",t),t;return o&&0!==o.length?(o||[]).map(e=>({id:e.id,version:e.version_number,content:e.content||"",format:e.format||"markdown",masterFormat:e.master_format||"markdown",timestamp:e.created_at?new Date(e.created_at).toLocaleString("pt-BR"):new Date().toLocaleString("pt-BR"),sourceData:e.source_data||{}})):[]}async function U(e){let r;if(!(0,c.aJ)(e))throw Error("ID de vers\xe3o inv\xe1lido");let{data:o,error:t}=await f.from("prompt_versions").select("*").eq("id",e).single();if(t)throw console.error("❌ [getPromptVersion] Erro ao buscar vers\xe3o:",t),t;if(!o)throw Error("Vers\xe3o n\xe3o encontrada");let{data:a,error:i}=await f.from("prompts").select("*").eq("id",o.prompt_id).single();if(i||!a)console.warn("⚠️ [getPromptVersion] Erro ao buscar prompt relacionado, usando dados m\xednimos:",i),r={persona:"",objetivo:"",contextoNegocio:"",contexto:"",regras:[],exemplos:[],variaveisDinamicas:[],ferramentas:[],formatoSaida:"text",masterPromptFormat:"markdown",estruturaSaida:"",fluxos:[],promptSize:5e3};else{let[e,o,t,i]=await Promise.all([f.from("few_shot_examples").select("*").eq("prompt_id",a.id).order("order_index"),f.from("variaveis_dinamicas").select("*").eq("prompt_id",a.id).order("order_index"),f.from("ferramentas").select("*").eq("prompt_id",a.id).order("order_index"),f.from("fluxos").select("*").eq("prompt_id",a.id).order("order_index")]);r={persona:a.persona||"",objetivo:a.objetivo||"",contextoNegocio:a.contexto_negocio||"",contexto:a.contexto||"",regras:a.regras||[],exemplos:(e.data||[]).map(e=>({id:e.id,user:e.user_text,agent:e.agent_text})),variaveisDinamicas:(o.data||[]).map(e=>({id:e.id,chave:e.chave,valor:e.valor})),ferramentas:(t.data||[]).map(e=>({id:e.id,nome:e.nome,descricao:e.descricao})),formatoSaida:a.formato_saida,masterPromptFormat:a.master_prompt_format,estruturaSaida:a.estrutura_saida||"",fluxos:(i.data||[]).map(e=>({id:e.id,nome:e.nome,tipoPrompt:e.tipo_prompt,objetivo:e.objetivo,baseConhecimentoRAG:e.base_conhecimento_rag||"",fewShotExamples:e.few_shot_examples||"",reforcarCoT:e.reforcar_cot||!1,ativarGuardrails:e.ativar_guardrails||!1})),promptSize:a.prompt_size||5e3}}return{id:o.id,version:o.version_number,content:o.content,format:o.format||"markdown",masterFormat:o.master_format||"markdown",timestamp:o.created_at?new Date(o.created_at).toLocaleString("pt-BR"):new Date().toLocaleString("pt-BR"),sourceData:r}}async function T(e,r){if(!await w())throw Error("Usu\xe1rio n\xe3o autenticado");if(!(0,c.aJ)(e))throw Error("ID de vers\xe3o de prompt inv\xe1lido");if(!r.author||!["user","agent"].includes(r.author))throw Error("Autor da mensagem inv\xe1lido");let o=(0,c.A_)(r.text,5e4);if(!o.valid)throw Error(o.error||"Texto da mensagem inv\xe1lido");let{data:t}=await f.from("chat_messages").select("order_index").eq("prompt_version_id",e).order("order_index",{ascending:!1}).limit(1).single(),a=t?t.order_index+1:0,{data:i,error:n}=await f.from("chat_messages").insert({prompt_version_id:e,author:r.author,text:o.sanitized||"",feedback:r.feedback,correction:r.correction?(0,c.jZ)(r.correction,5e3):null,order_index:a}).select().single();if(n)throw console.error("❌ ERRO ao salvar mensagem de chat no banco:",{message:n.message,details:n.details,hint:n.hint,code:n.code}),n;return i}async function q(e){if(!(0,c.aJ)(e))throw Error("ID de vers\xe3o de prompt inv\xe1lido");let r=await h();if(!r)throw Error("Perfil do usu\xe1rio n\xe3o encontrado");let{data:o,error:t}=await f.from("chat_messages").select("*, prompt_versions!inner(prompt_id, prompts!inner(user_id))").eq("prompt_versions.prompts.user_id",r.id).eq("prompt_version_id",e).order("order_index",{ascending:!0}).limit(100);if(t)throw console.error("❌ Erro ao buscar mensagens:",t),t;return o&&0!==o.length?(o||[]).map(e=>({author:"user"===e.author||"agent"===e.author?e.author:"user",text:e.text||"",feedback:e.feedback,isEditing:!1,correction:e.correction||void 0})):[]}async function N(){let e=await w();if(!e)throw Error("Usu\xe1rio n\xe3o autenticado");let{data:r,error:o}=await f.from("workspaces").select("*").eq("user_id",e.id).eq("is_active",!0).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(o)throw console.error("❌ [getUserWorkspaces] Erro ao buscar workspaces:",o),o;return r||[]}async function D(){let e=await w();if(!e)throw Error("Usu\xe1rio n\xe3o autenticado");let{data:r,error:o}=await f.from("workspaces").select("*").eq("user_id",e.id).eq("is_active",!0).eq("is_default",!0).single();if(o){if("PGRST116"===o.code)return await I();throw console.error("❌ [getDefaultWorkspace] Erro ao buscar workspace padr\xe3o:",o),o}return r}async function I(){let e=await w();if(!e)throw Error("Usu\xe1rio n\xe3o autenticado");let{data:r,error:o}=await f.from("workspaces").insert({user_id:e.id,name:"Meu Workspace",description:"Workspace padr\xe3o",is_active:!0,is_default:!0}).select().single();if(o)throw console.error("❌ [createDefaultWorkspace] Erro ao criar workspace padr\xe3o:",o),o;return r}async function y(e,r){let o=await w();if(!o)throw Error("Usu\xe1rio n\xe3o autenticado");let t=(0,c.jZ)(e.trim(),100);if(!t||0===t.length)throw Error("Nome do workspace n\xe3o pode estar vazio");let{data:a,error:i}=await f.from("workspaces").insert({user_id:o.id,name:t,description:r?(0,c.jZ)(r.trim(),500):null,is_active:!0,is_default:!1}).select().single();if(i)throw console.error("❌ [createWorkspace] Erro ao criar workspace:",i),i;return a}async function z(e,r){let o=await w();if(!o)throw Error("Usu\xe1rio n\xe3o autenticado");if(!(0,c.aJ)(e))throw Error("ID de workspace inv\xe1lido");let t={};if(void 0!==r.name){let e=(0,c.jZ)(r.name.trim(),100);if(!e||0===e.length)throw Error("Nome do workspace n\xe3o pode estar vazio");t.name=e}void 0!==r.description&&(t.description=r.description?(0,c.jZ)(r.description.trim(),500):null),t.updated_at=new Date().toISOString();let{data:a,error:i}=await f.from("workspaces").update(t).eq("id",e).eq("user_id",o.id).select().single();if(i)throw console.error("❌ [updateWorkspace] Erro ao atualizar workspace:",i),i;return a}async function C(e){let r=await w();if(!r)throw Error("Usu\xe1rio n\xe3o autenticado");if(!(0,c.aJ)(e))throw Error("ID de workspace inv\xe1lido");let{error:o}=await f.from("workspaces").update({is_default:!1}).eq("user_id",r.id).eq("is_default",!0);if(o)throw console.error("❌ [setDefaultWorkspace] Erro ao desmarcar workspaces padr\xe3o:",o),o;let{error:t}=await f.from("workspaces").update({is_default:!0}).eq("id",e).eq("user_id",r.id);if(t)throw console.error("❌ [setDefaultWorkspace] Erro ao definir workspace como padr\xe3o:",t),t}async function R(e){let r=await w();if(!r)throw Error("Usu\xe1rio n\xe3o autenticado");if(!(0,c.aJ)(e))throw Error("ID de workspace inv\xe1lido");let{data:o,error:t}=await f.from("workspaces").select("is_default").eq("id",e).eq("user_id",r.id).single();if(t)throw console.error("❌ [deleteWorkspace] Erro ao buscar workspace:",t),t;if(null==o?void 0:o.is_default)throw Error("N\xe3o \xe9 poss\xedvel deletar o workspace padr\xe3o. Crie outro workspace e defina-o como padr\xe3o primeiro.");let{error:a}=await f.from("workspaces").update({is_active:!1}).eq("id",e).eq("user_id",r.id);if(a)throw console.error("❌ [deleteWorkspace] Erro ao deletar workspace:",a),a}u&&p||console.warn("⚠️ Supabase n\xe3o configurado corretamente. A autentica\xe7\xe3o pode falhar.")},8231:(e,r,o)=>{o.d(r,{A_:()=>p,DT:()=>l,Eb:()=>i,Gg:()=>_,Hc:()=>v,Oj:()=>c,PO:()=>n,Zm:()=>d,aJ:()=>u,h4:()=>f,jZ:()=>s,yS:()=>m,zf:()=>h});let t=new Map,a={MAX_LOGIN_ATTEMPTS:5,BLOCK_DURATION_MINUTES:15,WINDOW_MINUTES:15,MAX_REQUESTS_PER_MINUTE:60,MAX_SIGNUP_PER_HOUR:5};function i(e,r){let o=Date.now(),i=t.get(e);if(!i)return t.set(e,{attempts:1,resetTime:o+60*a.WINDOW_MINUTES*1e3,blocked:!1}),{allowed:!0};if(i.blocked&&o<i.resetTime)return{allowed:!1,retryAfter:Math.ceil((i.resetTime-o)/1e3/60)};if(o>i.resetTime)return t.set(e,{attempts:1,resetTime:o+60*a.WINDOW_MINUTES*1e3,blocked:!1}),{allowed:!0};let n="login"===r?a.MAX_LOGIN_ATTEMPTS:"signup"===r?a.MAX_SIGNUP_PER_HOUR:a.MAX_REQUESTS_PER_MINUTE;return i.attempts>=n?(i.blocked=!0,i.resetTime=o+60*a.BLOCK_DURATION_MINUTES*1e3,{allowed:!1,retryAfter:a.BLOCK_DURATION_MINUTES}):(i.attempts++,{allowed:!0})}function n(e){t.delete(e)}function s(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;if(!e||"string"!=typeof e)return"";let o=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").replace(/[\x00-\x1F\x7F]/g,"").trim();return o.length>r&&(o=o.substring(0,r)),o}function d(e){let r={...e};for(let e of["__proto__","constructor","prototype"])delete r[e];return r}setInterval(function(){let e=Date.now();for(let[r,o]of t.entries())e>o.resetTime&&!o.blocked&&t.delete(r)},18e5);let l=function(e){return!!e&&"string"==typeof e&&/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)&&e.length<=254};function c(e){let r=[];if(!e||"string"!=typeof e)return{valid:!1,errors:["Senha \xe9 obrigat\xf3ria"],strength:"weak"};e.length<8&&r.push("Senha deve ter pelo menos 8 caracteres"),e.length>128&&r.push("Senha muito longa (m\xe1ximo 128 caracteres)");let o=/[A-Z]/.test(e),t=/[a-z]/.test(e),a=/\d/.test(e),i=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e);o||r.push("Senha deve conter pelo menos uma letra mai\xfascula"),t||r.push("Senha deve conter pelo menos uma letra min\xfascula"),a||r.push("Senha deve conter pelo menos um n\xfamero"),i||r.push("Senha deve conter pelo menos um caractere especial"),["password","12345678","qwerty","abc123","password123","admin","senha","123456","123456789","1234567890"].some(r=>e.toLowerCase().includes(r))&&r.push("Senha muito comum. Escolha uma senha mais segura");let n="weak",s=[o,t,a,i,e.length>=12].filter(Boolean).length;return s>=4&&e.length>=12?n="strong":s>=3&&(n="medium"),{valid:0===r.length,errors:r,strength:n}}function m(e){return e&&"string"==typeof e?e.length<2?{valid:!1,error:"Nome deve ter pelo menos 2 caracteres"}:e.length>100?{valid:!1,error:"Nome muito longo (m\xe1ximo 100 caracteres)"}:/^[a-zA-ZÀ-ÿ\u00f1\u00d1\s\-']+$/.test(e)?{valid:!0}:{valid:!1,error:"Nome cont\xe9m caracteres inv\xe1lidos"}:{valid:!1,error:"Nome \xe9 obrigat\xf3rio"}}function u(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function p(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e4;return e&&"string"==typeof e?e.length>r?{valid:!1,error:"Texto muito longo (m\xe1ximo ".concat(r," caracteres)")}:{valid:!0,sanitized:s(e,r)}:{valid:!1,error:"Texto \xe9 obrigat\xf3rio"}}function f(e){console.warn("\uD83D\uDD12 Security Event:",e)}function _(e){return e.size>0xa00000?{valid:!1,error:"Arquivo muito grande. Tamanho m\xe1ximo: ".concat(10,"MB")}:{valid:!0}}let w=["application/pdf","text/plain","text/markdown","text/x-markdown","text/html","text/csv","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];function h(e){return w.includes(e.type)||e.name.toLowerCase().endsWith(".md")||e.name.toLowerCase().endsWith(".txt")||e.name.toLowerCase().endsWith(".csv")||e.name.toLowerCase().endsWith(".xlsx")||e.name.toLowerCase().endsWith(".xls")?{valid:!0}:{valid:!1,error:"Tipo de arquivo n\xe3o permitido. Use PDF, TXT, MD, HTML, CSV, XLSX, XLS, DOC ou DOCX."}}function v(e,r){return r?"".concat(e||"anonymous","_").concat(r):e||"anonymous"}}}]);