(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[67],{6197:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var s=r(5155),o=r(2115),a=r(3217),c=r(6517),i=r(5172);let l=e=>{let{versionId:t}=e,[r,l]=(0,o.useState)([]),[n,d]=(0,o.useState)(""),[x,h]=(0,o.useState)(!0),[m,u]=(0,o.useState)(null),[p,b]=(0,o.useState)(!1),[g,f]=(0,o.useState)(""),[w,v]=(0,o.useState)("Agente"),[j,k]=(0,o.useState)(""),[N,C]=(0,o.useState)(!1),y=(0,o.useRef)(null),S=(0,o.useRef)(null);(0,o.useEffect)(()=>{(async()=>{if(!t){u("ID da vers\xe3o n\xe3o fornecido"),h(!1);return}try{var e;h(!0);let r=await (0,a.V1)(t);if(!r||!r.content){u("Vers\xe3o do prompt n\xe3o encontrada ou inv\xe1lida"),h(!1);return}if(f(r.content),await (0,c.Z4)(r.content),null==(e=r.sourceData)?void 0:e.persona){let e=r.sourceData.persona.match(/(?:eu sou (?:a|o)?|meu nome é|sou (?:a|o)?|chamo-me|me chamo)\s+([A-ZÁÉÍÓÚÀÈÌÒÙÂÊÎÔÛÃÕÇ][a-záéíóúàèìòùâêîôûãõç]+)/i);if(e&&e[1])v(e[1]);else{let e=r.content.match(/(?:eu sou (?:a|o)?|meu nome é|sou (?:a|o)?|chamo-me|me chamo)\s+([A-ZÁÉÍÓÚÀÈÌÒÙÂÊÎÔÛÃÕÇ][a-záéíóúàèìòùâêîôûãõç]+)/i);e&&e[1]&&v(e[1])}}else{let e=r.content.match(/(?:eu sou (?:a|o)?|meu nome é|sou (?:a|o)?|chamo-me|me chamo)\s+([A-ZÁÉÍÓÚÀÈÌÒÙÂÊÎÔÛÃÕÇ][a-záéíóúàèìòùâêîôûãõç]+)/i);e&&e[1]&&v(e[1])}h(!1)}catch(e){console.error("Erro ao carregar vers\xe3o:",e),u(e.message||"Erro ao carregar o chat. Verifique se o link est\xe1 correto."),h(!1)}})()},[t]);let E=async()=>{if(!n.trim()||p||!g)return;let e={author:"user",text:n.trim()};l(t=>[...t,e]),d(""),b(!0);try{let e=await (0,c.KR)(n.trim(),g),t={author:"agent",text:e};l(e=>[...e,t])}catch(t){console.error("Erro ao enviar mensagem:",t);let e={author:"agent",text:"Erro: ".concat(t.message||"N\xe3o foi poss\xedvel processar sua mensagem. Tente novamente.")};l(t=>[...t,e])}finally{b(!1)}};(0,o.useEffect)(()=>{var e;null==(e=S.current)||e.scrollIntoView({behavior:"smooth"})},[r]),(0,o.useEffect)(()=>{let e=e=>{y.current&&!y.current.contains(e.target)&&C(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let T=(e,t)=>{let s=r[e];if(s.feedback===t)return void l(t=>t.map((t,r)=>r===e?{...t,feedback:void 0,isEditing:!1}:t));"incorrect"===t?(l(t=>t.map((t,r)=>r===e?{...t,feedback:"incorrect",isEditing:!0}:t)),k(s.text)):l(t=>t.map((t,r)=>r===e?{...t,feedback:"correct",isEditing:!1}:t))},L=e=>e?e.replace(/\{\{\s*\$now\s*\}\}/gi,new Date().toLocaleString("pt-BR")).replace(/\{\{[^}]*\}\}/g,"").replace(/\s+/g," ").trim():"",z=e=>{if(0===r.length)return;let s="LaBPrompT",o="Hist\xf3rico de Chat - Cliente",a="Exportado em: ".concat(new Date().toLocaleString("pt-BR")),c=t?"Vers\xe3o ID: ".concat(t.substring(0,8),"..."):"";if("txt"===e){let e=[];e.push(s),e.push(o),e.push(""),e.push("Agente: ".concat(w)),e.push(c),e.push(a),e.push(""),e.push("=".repeat(50)),e.push(""),r.forEach((t,r)=>{let s="user"===t.author?"Cliente":w,o=L(t.text);e.push("".concat(s,": ").concat(o)),"incorrect"===t.feedback&&t.correction?(e.push("[FEEDBACK: Resposta marcada como incorreta]"),e.push("[Resposta Original]: ".concat(o)),e.push("[Corre\xe7\xe3o Sugerida pelo Cliente]: ".concat(L(t.correction)))):"correct"===t.feedback&&e.push("[FEEDBACK: Resposta marcada como correta ✓]"),e.push("")});let t=new Blob([e.join("\n")],{type:"text/plain;charset=utf-8"}),i=URL.createObjectURL(t),l=document.createElement("a");l.href=i,l.download="historico_chat_cliente_".concat(new Date().toISOString().split("T")[0],".txt"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)}else{let e=new i.uE({orientation:"portrait",unit:"mm",format:"a4",compress:!0}),t=20,l=e.internal.pageSize.getWidth(),n=e.internal.pageSize.getHeight();e.setFont("helvetica","normal"),e.setFontSize(24),e.setTextColor(16,185,129),e.text(s,10,t),t+=10,e.setDrawColor(200,200,200),e.setLineWidth(.5),e.line(10,t,l-10,t),t+=10,e.setFontSize(16),e.setTextColor(0,0,0),e.text(o,10,t),t+=8,e.setFontSize(11),e.setTextColor(60,60,60),e.text("Agente: ".concat(L(w)),10,t),t+=6,c&&(e.text(c,10,t),t+=6),e.setFontSize(10),e.setTextColor(100,100,100),e.text(a,10,t),t+=12,e.setDrawColor(200,200,200),e.line(10,t,l-10,t),t+=10,e.setFontSize(11),r.forEach((r,s)=>{let o="user"===r.author,a=L(r.text),c=.7*l,i=6*e.splitTextToSize(a,c-20).length+16+5,d=i;"incorrect"===r.feedback&&r.correction?d+=5*e.splitTextToSize(L(r.correction),c-20).length+15:"correct"===r.feedback&&(d+=8),t+d>n-10&&(e.addPage(),t=20);let x=o?l-c-10:10;e.setFillColor(o?16:60,o?185:60,o?129:60),e.setDrawColor(o?16:60,o?185:60,o?129:60),e.roundedRect(x,t,c,i,3,3,"FD"),e.setFontSize(9),e.setTextColor(255,255,255,80);let h=o?"Cliente":w;e.text(h,x+8,t+8+5),e.setFontSize(11),e.setTextColor(255,255,255);let m="incorrect"===r.feedback&&r.correction?L(r.correction):a,u=e.splitTextToSize(m,c-20);e.text(u,x+8,t+8+5+6);let p=t+i+8;if(!o)if("incorrect"===r.feedback&&r.correction){let t=L(r.correction),s=5*e.splitTextToSize(t,l-20-20).length+15;e.setFillColor(254,243,199),e.setDrawColor(251,191,36),e.setLineWidth(1),e.roundedRect(10,p,l-20,s,3,3,"FD"),e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(245,158,11),e.text("Corre\xe7\xe3o Sugerida pelo Cliente:",18,p+8),e.setFontSize(9),e.setFont("helvetica","normal"),e.setTextColor(150,150,150);let o=e.splitTextToSize("Original: ".concat(a),l-20-20);e.text(o,18,p+15),e.setTextColor(16,185,129);let c=e.splitTextToSize("Corre\xe7\xe3o: ".concat(t),l-20-20);e.text(c,18,p+15+5*o.length+5),p+=s+8}else"correct"===r.feedback&&(e.setFontSize(9),e.setTextColor(16,185,129),e.text("[Feedback: Resposta marcada como correta]",x+8,p),p+=10);t=p}),e.save("historico_chat_cliente_".concat(new Date().toISOString().split("T")[0],".pdf"))}C(!1)};return x?(0,s.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("svg",{className:"animate-spin h-12 w-12 text-emerald-400 mx-auto mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,s.jsx)("p",{className:"text-white/80",children:"Carregando chat..."})]})}):m?(0,s.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-center max-w-md mx-auto px-4",children:(0,s.jsxs)("div",{className:"bg-red-900/30 border border-red-700/50 rounded-lg p-6",children:[(0,s.jsx)("p",{className:"text-red-300 font-medium mb-2",children:"⚠️ Erro"}),(0,s.jsx)("p",{className:"text-red-400 text-sm",children:m})]})})}):(0,s.jsxs)("div",{className:"min-h-screen bg-black flex flex-col",children:[(0,s.jsx)("header",{className:"bg-black/80 backdrop-blur-sm border-b border-white/10 px-4 py-4",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-emerald-400 to-green-500 rounded-lg flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-6 h-6 text-black",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-white font-bold text-lg",children:"LaBPrompT"}),(0,s.jsxs)("p",{className:"text-white/60 text-xs",children:["Chat com ",w]})]})]}),r.length>0&&(0,s.jsxs)("div",{className:"relative",ref:y,children:[(0,s.jsxs)("button",{onClick:()=>C(!N),className:"flex items-center space-x-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors text-sm",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),(0,s.jsx)("span",{children:"Baixar"})]}),N&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-32 bg-black/90 border border-white/20 rounded-lg shadow-xl z-10 backdrop-blur-sm",children:[(0,s.jsx)("button",{onClick:()=>z("txt"),className:"block w-full text-left px-4 py-2 text-sm text-white/80 hover:bg-white/10",children:"Baixar TXT"}),(0,s.jsx)("button",{onClick:()=>z("pdf"),className:"block w-full text-left px-4 py-2 text-sm text-white/80 hover:bg-white/10",children:"Baixar PDF"})]})]})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto px-4 py-6",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[0===r.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-emerald-400 to-green-500 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-black",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,s.jsx)("p",{className:"text-white/80 text-lg mb-2",children:"Ol\xe1! \uD83D\uDC4B"}),(0,s.jsxs)("p",{className:"text-white/60 text-sm",children:["Comece a conversar com ",w]})]}):r.map((e,t)=>(0,s.jsxs)("div",{className:"flex flex-col ".concat("user"===e.author?"items-end":"items-start"),children:[(0,s.jsxs)("div",{className:"max-w-[80%] rounded-2xl px-4 py-3 ".concat("user"===e.author?"bg-emerald-600 text-white":"bg-white/10 text-white/80"),children:[(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:e.correction&&"incorrect"===e.feedback?e.correction:e.text}),e.correction&&"incorrect"===e.feedback&&(0,s.jsxs)("p",{className:"text-xs text-white/60 mt-2 line-through italic",children:["Resposta original: ",e.text.substring(0,100),"..."]})]}),"agent"===e.author&&(0,s.jsxs)("div",{className:"mt-2 flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>T(t,"correct"),title:"Resposta correta",className:"p-1.5 rounded-full transition-colors ".concat("correct"===e.feedback?"bg-green-500/30 text-green-400":"text-white/40 hover:text-green-400 hover:bg-white/10"),children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,s.jsx)("button",{onClick:()=>T(t,"incorrect"),title:"Resposta incorreta",className:"p-1.5 rounded-full transition-colors ".concat("incorrect"===e.feedback?"bg-red-500/30 text-red-400":"text-white/40 hover:text-red-400 hover:bg-white/10"),children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),"agent"===e.author&&"incorrect"===e.feedback&&e.isEditing&&(0,s.jsxs)("div",{className:"mt-3 w-full max-w-[80%]",children:[(0,s.jsx)("label",{className:"block text-xs text-white/60 mb-2",children:"Corrija a resposta do agente:"}),(0,s.jsx)("textarea",{value:j,onChange:e=>k(e.target.value),className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white/80 placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-500 text-sm",rows:3,placeholder:"Digite a resposta correta..."}),(0,s.jsxs)("div",{className:"mt-2 flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>{j.trim()&&(l(e=>e.map((e,r)=>r===t?{...e,correction:j.trim(),isEditing:!1}:e)),k(""))},className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors text-sm",children:"Salvar Corre\xe7\xe3o"}),(0,s.jsx)("button",{onClick:()=>l(e=>e.map((e,r)=>r===t?{...e,isEditing:!1}:e)),className:"px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors text-sm",children:"Cancelar"})]})]}),"agent"===e.author&&"incorrect"===e.feedback&&e.correction&&!e.isEditing&&(0,s.jsxs)("div",{className:"mt-2 p-3 bg-emerald-900/20 border border-emerald-700/50 rounded-lg max-w-[80%]",children:[(0,s.jsx)("p",{className:"text-xs text-emerald-300 mb-1",children:"✓ Corre\xe7\xe3o salva"}),(0,s.jsx)("p",{className:"text-sm text-white/80",children:e.correction})]})]},t)),p&&(0,s.jsx)("div",{className:"flex justify-start",children:(0,s.jsx)("div",{className:"bg-white/10 rounded-2xl px-4 py-3",children:(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-white/60 rounded-full animate-bounce"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-white/60 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-white/60 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),(0,s.jsx)("div",{ref:S})]})}),(0,s.jsx)("div",{className:"bg-black/80 backdrop-blur-sm border-t border-white/10 px-4 py-4",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto flex space-x-3",children:[(0,s.jsx)("input",{type:"text",value:n,onChange:e=>d(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),E())},placeholder:"Digite sua mensagem...",disabled:p,className:"flex-1 px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-emerald-500 disabled:opacity-50"}),(0,s.jsx)("button",{onClick:E,disabled:!n.trim()||p,className:"px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Enviar"})]})})]})};function n(e){let{params:t}=e,{versionId:r}=(0,o.use)(t);return(0,s.jsx)(l,{versionId:r})}},7793:(e,t,r)=>{Promise.resolve().then(r.bind(r,6197))}},e=>{e.O(0,[798,930,33,503,241,217,517,441,255,358],()=>e(e.s=7793)),_N_E=e.O()}]);