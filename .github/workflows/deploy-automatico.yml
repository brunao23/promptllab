name: ðŸ”„ Deploy AutomÃ¡tico (Vercel Integration)

on:
  push:
    branches:
      - main
      - master
  pull_request:
    branches:
      - main
      - master

jobs:
  deploy:
    name: Build e Deploy
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: â¬‡ï¸ Checkout do cÃ³digo
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: ðŸ“‹ Verificar estrutura
        run: |
          echo "ðŸ“ Estrutura do repositÃ³rio:"
          ls -la
          echo ""
          echo "ðŸ“¦ Verificando package.json:"
          if [ -f package.json ]; then
            echo "âœ… package.json encontrado"
            cat package.json | head -10
          else
            echo "âŒ package.json NÃƒO encontrado!"
            exit 1
          fi

      - name: ðŸ“¥ Instalar dependÃªncias
        run: |
          echo "ðŸ“¥ Instalando dependÃªncias..."
          if [ -f package-lock.json ]; then
            echo "Usando npm ci (package-lock.json encontrado)"
            npm ci
          else
            echo "Usando npm install (package-lock.json nÃ£o encontrado)"
            npm install
          fi
          echo "âœ… DependÃªncias instaladas"

      - name: ðŸ” Verificar build
        run: |
          echo "ðŸ” Iniciando build..."
          npm run build
          echo "âœ… Build concluÃ­do"
        env:
          VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL || '' }}
          VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY || '' }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY || '' }}
          API_KEY: ${{ secrets.GEMINI_API_KEY || '' }}

      - name: âœ… Verificar artefatos do build
        run: |
          echo "ðŸ“¦ Verificando artefatos do build..."
          if [ -d "dist" ]; then
            echo "âœ… DiretÃ³rio dist encontrado"
            ls -la dist/ | head -10
            echo ""
            echo "ðŸ“Š Tamanho do build:"
            du -sh dist/
          else
            echo "âŒ DiretÃ³rio dist NÃƒO encontrado!"
            exit 1
          fi
          
      - name: âœ… Build concluÃ­do
        run: |
          echo "âœ… Build concluÃ­do com sucesso!"
          echo "ðŸ“¦ Os arquivos estÃ£o prontos em ./dist"
          echo ""
          echo "ðŸ’¡ Nota: Se vocÃª configurou a integraÃ§Ã£o direta GitHub+Vercel,"
          echo "   o deploy serÃ¡ feito automaticamente pela Vercel apÃ³s este workflow."
          echo ""
          echo "ðŸ”— Configure a integraÃ§Ã£o em: https://vercel.com/dashboard"
          echo "   Settings > Git > Connect Repository"

