name: üîÑ Deploy Autom√°tico (Vercel Integration)

on:
  push:
    branches:
      - main
      - master
  pull_request:
    branches:
      - main
      - master

jobs:
  build:
    name: Build e Verifica√ß√£o
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: ‚¨áÔ∏è Checkout do c√≥digo
        uses: actions/checkout@v4

      - name: üì¶ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: üìã Verificar estrutura
        run: |
          echo "üìÅ Estrutura do reposit√≥rio:"
          ls -la
          echo ""
          echo "üì¶ Verificando package.json:"
          if [ -f "labprompt/package.json" ]; then
            echo "‚úÖ package.json encontrado em ./labprompt"
            cat labprompt/package.json | head -10
          elif [ -f "package.json" ]; then
            echo "‚úÖ package.json encontrado na raiz"
            cat package.json | head -10
          else
            echo "‚ùå package.json N√ÉO encontrado!"
            exit 1
          fi

      - name: üì• Instalar depend√™ncias
        working-directory: ./labprompt
        run: |
          echo "üì• Instalando depend√™ncias..."
          if [ -f package-lock.json ]; then
            echo "Usando npm ci (package-lock.json encontrado)"
            npm ci
          else
            echo "Usando npm install (package-lock.json n√£o encontrado)"
            npm install
          fi
          echo "‚úÖ Depend√™ncias instaladas"

      - name: üîç Verificar build
        working-directory: ./labprompt
        run: |
          echo "üîç Iniciando build..."
          npm run build
          echo "‚úÖ Build conclu√≠do"
        env:
          VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL || 'https://placeholder.supabase.co' }}
          VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY || 'placeholder-key' }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY || '' }}
          API_KEY: ${{ secrets.GEMINI_API_KEY || '' }}

      - name: ‚úÖ Verificar artefatos do build
        working-directory: ./labprompt
        run: |
          echo "üì¶ Verificando artefatos do build..."
          if [ -d "dist" ]; then
            echo "‚úÖ Diret√≥rio dist encontrado"
            ls -la dist/ | head -10
            echo ""
            echo "üìä Tamanho do build:"
            du -sh dist/
          else
            echo "‚ùå Diret√≥rio dist N√ÉO encontrado!"
            exit 1
          fi
          
      - name: ‚úÖ Build conclu√≠do
        run: |
          echo "‚úÖ Build conclu√≠do com sucesso!"
          echo "üì¶ Os arquivos est√£o prontos em ./labprompt/dist"
          echo ""
          echo "üí° IMPORTANTE: Se voc√™ configurou a integra√ß√£o direta GitHub+Vercel,"
          echo "   o deploy ser√° feito automaticamente pela Vercel ap√≥s este workflow."
          echo ""
          echo "üîó Configure a integra√ß√£o em: https://vercel.com/dashboard"
          echo "   Settings > Git > Connect Repository"
          echo ""
          echo "‚ö†Ô∏è  Se o deploy autom√°tico da Vercel n√£o funcionar, verifique:"
          echo "   1. Se o reposit√≥rio est√° conectado na Vercel"
          echo "   2. Se o Root Directory est√° configurado como 'labprompt' (n√£o vazio!)"
          echo "   3. Se as vari√°veis de ambiente est√£o configuradas"

